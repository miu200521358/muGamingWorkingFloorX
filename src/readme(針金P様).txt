WorkingFloorX.fx ver0.0.6

床面鏡像描画＋Xシャドー描画を行います。
以前作成したWorkingFloor2.fxにXシャドーを追加しました。
Xシャドーについてはmqdl氏のxshadow.fxを参考にしました。

エフェクトファイル一つ読むだけですべての人型モデルにXシャドーが追加できます。
Xシャドーのサイズはモデルの大きさで,濃度はライトの強さで自動調整されます。


・使用方法
(1)MMDの地面影は非表示に設定してください。
(2)WorkingFloorX.xをMMDにロードします。
(3)デフォルトで鏡像化されるモデルは 全てのPMD・PMX,および.vec になっています。
   個別に適用したい場合は以下の方法でfxファイルをそれぞれ設定します。

   ｢MMEffect｣→｢エフェクト割当｣→｢WorkingFloorRT｣タブを開き、鏡像化したいオブジェクトを選択して、WF_Object.fxsubを適用する。
   また｢WorkingFloorRT｣タブで鏡像化しないモデルは非表示にする。

(4)MMDのアクセサリパラメータで以下の変更を行いキーフレーム登録してください。
    Tr：床面鏡像の透過度
    その他のパラメータで床の描画範囲を設定します。
    エフェクトをoffにした時のWorkingFloorX.xの白い板ポリ内が描画範囲になります。
    X影はWorkingFloorX.xの高さ(アクセサリパラメータYの高さ)に描画されます。鏡面の傾きには連動しません。
(5)XシャドーについてはWF_XShadow.fxの先頭パラメータを必要に応じて変更してください
(6)描画順序は，背景ステージ→WorkingFloorX.x→その他のオブジェクトの順に設定してください。

Tr=0にすることでXシャドーのみの表示も可能ですが,内部では鏡像描画も行っていて処理の無駄になります。
鏡像描画処理を完全に無くしたい場合はWorkingFloorX.fxの先頭パラメータの書き換えをおすすめします。


・MikuMikuMovingについて
このエフェクトはMikuMikuMovingにも対応しています。
WorkingFloorX.fxを直接MikuMikuMovingにロードしてご利用下さい。


・応用
WorkingFloorX.xを別形状のモデルに置き換えることでステージの形状に合わせて鏡像描画する範囲を
制限することが出来ます。

Xシャドーと床面鏡像の間に床アクセを挟みたい場合はWorkingFloor2と併用することで可能になります。
　①WorkingFloorX.fxの先頭パラメータの書き換えて鏡像描画処理をOFFにする
　②WorkingFloor2.x,WorkingFloorX.x両方ロードして、描画順をWorkingFloor2.x→床アクセ→WorkingFloorX.xにする


・注意点
一部のグラフィックボードでモデルの鏡像が正常に描画されない(モデルが黒または白になる)ことが
あります。この場合、WorkingFloorX.fxの先頭パラメータFLG_EXCEPTIONを変更してご利用ください。


※このFXファイルはMMEver0.33以降でないと正しく動作しません。


・更新履歴
v0.0.6  2015/10/17  X影の描画高さを鏡面の高さに合わせるようにした。
v0.0.5  2013/11/17  一部のグラボで鏡像モデルが正常に描画されない不具合への対応
                    一部のグラボでX影が正常に描画されなかった不具合の修正
                    FXファイル先頭でX影の色変更パラメータ追加
v0.0.4  2013/7/05   MMEシェーダを新しいバージョン(v0.33以降)仕様にした(PMXの材質モーフ､サブTex等に対応)
                    MikuMikuMovingの対応
v0.0.3  2012/9/10   x64版の標準ミップマップテクスチャ対応,内部コードの整理,
                    鏡像変換方法･X影生成方法の簡素化,照明によるX影の濃度調整方法を変更
v0.0.2  2011/9/28   マスク処理を使わずに描画できるように改良(レンダリング負荷軽減)
v0.0.1  2011/9/18   初回版公開


・免責事項
ご利用・改変・二次配布は自由にやっていただいてかまいません。連絡も不要です。
ただしこれらの行為は全て自己責任でやってください。
このプログラム使用により、いかなる損害が生じた場合でも当方は一切の責任を負いません。


by 針金P
Twitter : @HariganeP


